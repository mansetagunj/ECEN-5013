\hypertarget{light__sensor__task_8h}{}\section{/home/gunj/repos/\+E\+C\+E\+N-\/5013/\+Project1/include/common/light\+\_\+sensor\+\_\+task.h File Reference}
\label{light__sensor__task_8h}\index{/home/gunj/repos/\+E\+C\+E\+N-\/5013/\+Project1/include/common/light\+\_\+sensor\+\_\+task.\+h@{/home/gunj/repos/\+E\+C\+E\+N-\/5013/\+Project1/include/common/light\+\_\+sensor\+\_\+task.\+h}}
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$mqueue.\+h$>$}\\*
{\ttfamily \#include \char`\"{}common\+\_\+helper.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}my\+\_\+time.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}error\+\_\+data.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}sensor\+\_\+common\+\_\+object.\+h\char`\"{}}\\*
Include dependency graph for light\+\_\+sensor\+\_\+task.\+h\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{light__sensor__task_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{light__sensor__task_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structLIGHTTASKQ__MSG__T}{L\+I\+G\+H\+T\+T\+A\+S\+K\+Q\+\_\+\+M\+S\+G\+\_\+T}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{light__sensor__task_8h_ad3c64139927109ac2021342f1912828b}{D\+E\+F\+I\+N\+E\+\_\+\+L\+I\+G\+H\+T\+\_\+\+S\+T\+R\+U\+CT}(name,  msg\+Id,  source\+Id)
\begin{DoxyCompactList}\small\item\em Defines a light struct with the name given and params with some default values. \end{DoxyCompactList}\item 
\#define {\bfseries P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+SK}(p\+\_\+lightstruct)
\item 
\#define {\bfseries P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+S\+K\+\_\+\+E\+X\+IT}(p\+\_\+lightstruct)
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries D\+A\+Y\+\_\+\+S\+T\+A\+T\+E\+\_\+T} \{ {\bfseries D\+AY} = 0, 
{\bfseries N\+I\+G\+HT} = 1
 \}\hypertarget{light__sensor__task_8h_a7d714c313df3e00dc24e02490e1c4c08}{}\label{light__sensor__task_8h_a7d714c313df3e00dc24e02490e1c4c08}

\item 
enum {\bfseries L\+I\+G\+H\+T\+T\+A\+S\+K\+Q\+\_\+\+M\+S\+G\+I\+D\+\_\+T} \{ \\*
{\bfseries L\+I\+G\+H\+T\+\_\+\+M\+S\+G\+\_\+\+T\+A\+S\+K\+\_\+\+S\+T\+A\+T\+US}, 
{\bfseries L\+I\+G\+H\+T\+\_\+\+M\+S\+G\+\_\+\+T\+A\+S\+K\+\_\+\+G\+E\+T\+\_\+\+S\+T\+A\+TE}, 
{\bfseries L\+I\+G\+H\+T\+\_\+\+M\+S\+G\+\_\+\+T\+A\+S\+K\+\_\+\+R\+E\+A\+D\+\_\+\+D\+A\+TA}, 
{\bfseries L\+I\+G\+H\+T\+\_\+\+M\+S\+G\+\_\+\+T\+A\+S\+K\+\_\+\+W\+R\+I\+T\+E\+\_\+\+C\+MD}, 
\\*
{\bfseries L\+I\+G\+H\+T\+\_\+\+M\+S\+G\+\_\+\+T\+A\+S\+K\+\_\+\+P\+O\+W\+E\+R\+D\+O\+WN}, 
{\bfseries L\+I\+G\+H\+T\+\_\+\+M\+S\+G\+\_\+\+T\+A\+S\+K\+\_\+\+P\+O\+W\+E\+R\+UP}, 
{\bfseries L\+I\+G\+H\+T\+\_\+\+M\+S\+G\+\_\+\+T\+A\+S\+K\+\_\+\+E\+X\+IT}
 \}\hypertarget{light__sensor__task_8h_ab864429fd48fdeac96f07665a36779f1}{}\label{light__sensor__task_8h_ab864429fd48fdeac96f07665a36779f1}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
mqd\+\_\+t \hyperlink{light__sensor__task_8h_ace4b0c78a43f482e74bc1d7a717c753c}{get\+Handle\+\_\+\+Light\+Task\+Queue} ()
\begin{DoxyCompactList}\small\item\em Get the Handle Light\+Task\+Queue object. \end{DoxyCompactList}\item 
D\+A\+Y\+\_\+\+S\+T\+A\+T\+E\+\_\+T \hyperlink{light__sensor__task_8h_a2fb8d8bd6f3ac82658743d379b205a51}{get\+Light\+Task\+\_\+state} ()
\begin{DoxyCompactList}\small\item\em Get the Light\+Task state object M\+T-\/safe. \end{DoxyCompactList}\item 
float \hyperlink{light__sensor__task_8h_ac88a5567bdeac532053519330e94c6ab}{get\+Light\+Task\+\_\+lux} ()
\begin{DoxyCompactList}\small\item\em Get the Light\+Task lux object. M\+T-\/safe as it calls a M\+T-\/safe function within. \end{DoxyCompactList}\item 
void $\ast$ \hyperlink{light__sensor__task_8h_a638f4ba787ad818d90477af9e572771c}{light\+\_\+task\+\_\+callback} (void $\ast$threadparam)
\begin{DoxyCompactList}\small\item\em Entry point of the light task thread. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyAuthor}{Author}
Gunj Manseta 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2018-\/03-\/11 
\end{DoxyDate}


\subsection{Macro Definition Documentation}
\index{light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}!D\+E\+F\+I\+N\+E\+\_\+\+L\+I\+G\+H\+T\+\_\+\+S\+T\+R\+U\+CT@{D\+E\+F\+I\+N\+E\+\_\+\+L\+I\+G\+H\+T\+\_\+\+S\+T\+R\+U\+CT}}
\index{D\+E\+F\+I\+N\+E\+\_\+\+L\+I\+G\+H\+T\+\_\+\+S\+T\+R\+U\+CT@{D\+E\+F\+I\+N\+E\+\_\+\+L\+I\+G\+H\+T\+\_\+\+S\+T\+R\+U\+CT}!light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}}
\subsubsection[{\texorpdfstring{D\+E\+F\+I\+N\+E\+\_\+\+L\+I\+G\+H\+T\+\_\+\+S\+T\+R\+U\+CT}{DEFINE_LIGHT_STRUCT}}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+I\+N\+E\+\_\+\+L\+I\+G\+H\+T\+\_\+\+S\+T\+R\+U\+CT(
\begin{DoxyParamCaption}
\item[{}]{name, }
\item[{}]{msg\+Id, }
\item[{}]{source\+Id}
\end{DoxyParamCaption}
)}\hypertarget{light__sensor__task_8h_ad3c64139927109ac2021342f1912828b}{}\label{light__sensor__task_8h_ad3c64139927109ac2021342f1912828b}
{\bfseries Value\+:}
\begin{DoxyCode}
\hyperlink{structLIGHTTASKQ__MSG__T}{LIGHTTASKQ\_MSG\_T} name = \{      \(\backslash\)
        .msgID      = msgId,        \(\backslash\)
        .sourceID   = sourceId,     \(\backslash\)
        .packet     = \{0\}           \(\backslash\)
    \};
\end{DoxyCode}


Defines a light struct with the name given and params with some default values. 

\index{light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}!P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+SK@{P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+SK}}
\index{P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+SK@{P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+SK}!light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}}
\subsubsection[{\texorpdfstring{P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+SK}{POST_MESSAGE_LIGHTTASK}}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+SK(
\begin{DoxyParamCaption}
\item[{}]{p\+\_\+lightstruct}
\end{DoxyParamCaption}
)}\hypertarget{light__sensor__task_8h_ae936fca69f20a6a81f530eb38806bd3c}{}\label{light__sensor__task_8h_ae936fca69f20a6a81f530eb38806bd3c}
{\bfseries Value\+:}
\begin{DoxyCode}
\textcolor{keywordflow}{do}\{ \(\backslash\)
        \_\_POST\_MESSAGE\_LIGHTTASK(\hyperlink{light__sensor__task_8h_ace4b0c78a43f482e74bc1d7a717c753c}{getHandle\_LightTaskQueue}(), p\_lightstruct, \textcolor{keyword}{sizeof}(
      *p\_lightstruct),20); \(\backslash\)
    \}\textcolor{keywordflow}{while}(0)
\end{DoxyCode}
\index{light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}!P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+S\+K\+\_\+\+E\+X\+IT@{P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+S\+K\+\_\+\+E\+X\+IT}}
\index{P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+S\+K\+\_\+\+E\+X\+IT@{P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+S\+K\+\_\+\+E\+X\+IT}!light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}}
\subsubsection[{\texorpdfstring{P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+S\+K\+\_\+\+E\+X\+IT}{POST_MESSAGE_LIGHTTASK_EXIT}}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+O\+S\+T\+\_\+\+M\+E\+S\+S\+A\+G\+E\+\_\+\+L\+I\+G\+H\+T\+T\+A\+S\+K\+\_\+\+E\+X\+IT(
\begin{DoxyParamCaption}
\item[{}]{p\+\_\+lightstruct}
\end{DoxyParamCaption}
)}\hypertarget{light__sensor__task_8h_abafa6c4697460e4887f6d6e9c1f15749}{}\label{light__sensor__task_8h_abafa6c4697460e4887f6d6e9c1f15749}
{\bfseries Value\+:}
\begin{DoxyCode}
\textcolor{keywordflow}{do}\{ \(\backslash\)
        \_\_POST\_MESSAGE\_LIGHTTASK(\hyperlink{light__sensor__task_8h_ace4b0c78a43f482e74bc1d7a717c753c}{getHandle\_LightTaskQueue}(), p\_lightstruct, \textcolor{keyword}{sizeof}(
      *p\_lightstruct),50); \(\backslash\)
    \}\textcolor{keywordflow}{while}(0)
\end{DoxyCode}


\subsection{Function Documentation}
\index{light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}!get\+Handle\+\_\+\+Light\+Task\+Queue@{get\+Handle\+\_\+\+Light\+Task\+Queue}}
\index{get\+Handle\+\_\+\+Light\+Task\+Queue@{get\+Handle\+\_\+\+Light\+Task\+Queue}!light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}}
\subsubsection[{\texorpdfstring{get\+Handle\+\_\+\+Light\+Task\+Queue()}{getHandle_LightTaskQueue()}}]{\setlength{\rightskip}{0pt plus 5cm}mqd\+\_\+t get\+Handle\+\_\+\+Light\+Task\+Queue (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{light__sensor__task_8h_ace4b0c78a43f482e74bc1d7a717c753c}{}\label{light__sensor__task_8h_ace4b0c78a43f482e74bc1d7a717c753c}


Get the Handle Light\+Task\+Queue object. 

\begin{DoxyReturn}{Returns}
mqd\+\_\+t 
\end{DoxyReturn}

\begin{DoxyCode}
86 \{
87     \textcolor{keywordflow}{return} lighttask\_q;
88 \}
\end{DoxyCode}
\index{light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}!get\+Light\+Task\+\_\+lux@{get\+Light\+Task\+\_\+lux}}
\index{get\+Light\+Task\+\_\+lux@{get\+Light\+Task\+\_\+lux}!light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}}
\subsubsection[{\texorpdfstring{get\+Light\+Task\+\_\+lux()}{getLightTask_lux()}}]{\setlength{\rightskip}{0pt plus 5cm}float get\+Light\+Task\+\_\+lux (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{light__sensor__task_8h_ac88a5567bdeac532053519330e94c6ab}{}\label{light__sensor__task_8h_ac88a5567bdeac532053519330e94c6ab}


Get the Light\+Task lux object. M\+T-\/safe as it calls a M\+T-\/safe function within. 

\begin{DoxyReturn}{Returns}
float 
\end{DoxyReturn}

\begin{DoxyCode}
46 \{
47     \textcolor{keywordtype}{float} lux = \hyperlink{apds9301__sensor_8c_a55e164e7dd0586de71a8dd5b25ae9ef3}{APDS9301\_getLux}();
48     \textcolor{keywordflow}{return} lux;
49 \}
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{light__sensor__task_8h_ac88a5567bdeac532053519330e94c6ab_icgraph}
\end{center}
\end{figure}


\index{light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}!get\+Light\+Task\+\_\+state@{get\+Light\+Task\+\_\+state}}
\index{get\+Light\+Task\+\_\+state@{get\+Light\+Task\+\_\+state}!light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}}
\subsubsection[{\texorpdfstring{get\+Light\+Task\+\_\+state()}{getLightTask_state()}}]{\setlength{\rightskip}{0pt plus 5cm}D\+A\+Y\+\_\+\+S\+T\+A\+T\+E\+\_\+T get\+Light\+Task\+\_\+state (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{light__sensor__task_8h_a2fb8d8bd6f3ac82658743d379b205a51}{}\label{light__sensor__task_8h_a2fb8d8bd6f3ac82658743d379b205a51}


Get the Light\+Task state object M\+T-\/safe. 

\begin{DoxyReturn}{Returns}
D\+A\+Y\+\_\+\+S\+T\+A\+T\+E\+\_\+T 
\end{DoxyReturn}

\begin{DoxyCode}
37 \{
38     DAY\_STATE\_T state;
39     pthread\_mutex\_lock(&stateChangeLock);
40     state = isDay;
41     pthread\_mutex\_unlock(&stateChangeLock);
42     \textcolor{keywordflow}{return} state;
43 \}
\end{DoxyCode}


Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{light__sensor__task_8h_a2fb8d8bd6f3ac82658743d379b205a51_icgraph}
\end{center}
\end{figure}


\index{light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}!light\+\_\+task\+\_\+callback@{light\+\_\+task\+\_\+callback}}
\index{light\+\_\+task\+\_\+callback@{light\+\_\+task\+\_\+callback}!light\+\_\+sensor\+\_\+task.\+h@{light\+\_\+sensor\+\_\+task.\+h}}
\subsubsection[{\texorpdfstring{light\+\_\+task\+\_\+callback(void $\ast$threadparam)}{light_task_callback(void *threadparam)}}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ light\+\_\+task\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{threadparam}
\end{DoxyParamCaption}
)}\hypertarget{light__sensor__task_8h_a638f4ba787ad818d90477af9e572771c}{}\label{light__sensor__task_8h_a638f4ba787ad818d90477af9e572771c}


Entry point of the light task thread. 


\begin{DoxyParams}{Parameters}
{\em threadparam} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void$\ast$ 
\end{DoxyReturn}

\begin{DoxyCode}
204 \{
205     LOG\_STDOUT(INFO \textcolor{stringliteral}{"LIGHT TASK STARTED\(\backslash\)n"});
206 
207     \textcolor{keywordtype}{int} ret = \hyperlink{light__sensor__task_8c_abb5f74ca3376b1b610b7dac47ecae8d8}{light\_task\_queue\_init}();
208     \textcolor{keywordflow}{if}(ERR == ret)
209     \{
210         LOG\_STDOUT(ERROR \textcolor{stringliteral}{"LIGHT TASK QUEUE INIT:%s\(\backslash\)n"},strerror(errno));
211         exit(ERR);
212     \}
213 
214     \hyperlink{structi2c__handle}{I2C\_MASTER\_HANDLE\_T} i2c;
215     ret = light\_task\_sensorUP(&i2c);
216     \textcolor{keywordflow}{if}(ERR == ret)
217     \{
218         LOG\_STDOUT(ERROR \textcolor{stringliteral}{"LIGHT TASK SENSOR INIT:%s\(\backslash\)n"},strerror(errno));
219         \textcolor{keywordflow}{goto} FAIL\_EXIT\_SENSOR;
220     \}
221 
222     
223     LOG\_STDOUT(INFO \textcolor{stringliteral}{"[OK] LIGHT TASK INIT COMPLETED\(\backslash\)n"});
224     pthread\_barrier\_wait(&tasks\_barrier);
225 
226     \textcolor{comment}{/* Registering a timer for 2 sec to update the state of the snesor value by getting the lux value from
       the sensor*/}
227     timer\_t timer\_id;
228     \textcolor{keywordflow}{if}(ERR == \hyperlink{common__helper_8c_a23124253b968391b9777fc3b8a0cc5ec}{register\_and\_start\_timer}(&timer\_id, 2*MICROSEC, 0, 
      timer\_handler\_getAndUpdateState, &timer\_id))
229     \{
230         \textcolor{comment}{// LOG\_STDOUT(ERROR "Timer Error\(\backslash\)n");}
231         \textcolor{keywordflow}{goto} FAIL\_EXIT;
232     \}
233 
234     \textcolor{comment}{/* Process Log queue msg which executes untill the log\_task\_end flag is set to true*/}
235     light\_task\_processMsg();
236 
237     ret = \hyperlink{posixTimer_8c_a91f15230e46caba2a2132b04e9c73e47}{delete\_timer}(timer\_id);
238     \textcolor{keywordflow}{if}(ERR == ret)
239     \{
240         LOG\_STDOUT(ERROR \textcolor{stringliteral}{"LIGHT TASK DELETE TIMER:%s\(\backslash\)n"},strerror(errno));
241     \}
242 
243 FAIL\_EXIT:
244 
245     light\_task\_sensorDOWN(&i2c);
246 
247 FAIL\_EXIT\_SENSOR:
248     mq\_close(lighttask\_q);
249     LOG\_STDOUT(INFO \textcolor{stringliteral}{"Light task exit.\(\backslash\)n"});
250     \textcolor{keywordflow}{return} SUCCESS;
251 \}\end{DoxyCode}
