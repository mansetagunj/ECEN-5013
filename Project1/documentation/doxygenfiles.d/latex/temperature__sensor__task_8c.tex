\hypertarget{temperature__sensor__task_8c}{}\section{/home/gunj/repos/\+E\+C\+E\+N-\/5013/\+Project1/src/temperature\+\_\+sensor\+\_\+task.c File Reference}
\label{temperature__sensor__task_8c}\index{/home/gunj/repos/\+E\+C\+E\+N-\/5013/\+Project1/src/temperature\+\_\+sensor\+\_\+task.\+c@{/home/gunj/repos/\+E\+C\+E\+N-\/5013/\+Project1/src/temperature\+\_\+sensor\+\_\+task.\+c}}
{\ttfamily \#include $<$pthread.\+h$>$}\\*
{\ttfamily \#include $<$fcntl.\+h$>$}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include $<$mqueue.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include \char`\"{}main\+\_\+task.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}logger\+\_\+task.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}error\+\_\+data.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}temperature\+\_\+sensor\+\_\+task.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}my\+\_\+i2c.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tmp102\+\_\+sensor.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}common\+\_\+helper.\+h\char`\"{}}\\*
Include dependency graph for temperature\+\_\+sensor\+\_\+task.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{temperature__sensor__task_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define {\bfseries M\+Q\+\_\+\+T\+E\+M\+P\+E\+R\+A\+T\+U\+R\+E\+T\+A\+S\+K\+\_\+\+N\+A\+ME}~\char`\"{}/temperaturetask\+\_\+queue\char`\"{}\hypertarget{temperature__sensor__task_8c_a6550cb368d8a0ec6958a62cfb51fcb00}{}\label{temperature__sensor__task_8c_a6550cb368d8a0ec6958a62cfb51fcb00}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
float \hyperlink{temperature__sensor__task_8c_a4bea76689b1b882f95e488a1bb41f5f8}{get\+Temp\+Task\+\_\+temperature} ()
\begin{DoxyCompactList}\small\item\em Get the Temp\+Task temperature object M\+T-\/safe. \end{DoxyCompactList}\item 
mqd\+\_\+t \hyperlink{temperature__sensor__task_8c_afebaba221409b026d6f4648ac50b0c4e}{get\+Handle\+\_\+\+Temperature\+Task\+Queue} ()
\begin{DoxyCompactList}\small\item\em Get the Handle Temperature\+Task\+Queue object. \end{DoxyCompactList}\item 
int \hyperlink{temperature__sensor__task_8c_ad54a52f7c1962f12523c89f17484f5d9}{temperature\+\_\+task\+\_\+queue\+\_\+init} ()
\item 
void {\bfseries temperature\+\_\+task\+\_\+process\+Msg} ()\hypertarget{temperature__sensor__task_8c_adf36688df6c9b7833fff8c6d84febc3a}{}\label{temperature__sensor__task_8c_adf36688df6c9b7833fff8c6d84febc3a}

\item 
int \hyperlink{temperature__sensor__task_8c_ad16d2f35c6d97e33cfe57e3ab2497064}{temperature\+\_\+task\+\_\+\+I2\+Cinit} (\hyperlink{my__i2c_8h_ab57e25e9caf06380c1d3587fa9866c1e}{I2\+C\+\_\+\+M\+A\+S\+T\+E\+R\+\_\+\+H\+A\+N\+D\+L\+E\+\_\+T} $\ast$i2c)
\item 
int \hyperlink{temperature__sensor__task_8c_a7b3917c753224bc64f378ca8e61cc941}{temperature\+\_\+task\+\_\+\+I2\+Cdeinit} (\hyperlink{my__i2c_8h_ab57e25e9caf06380c1d3587fa9866c1e}{I2\+C\+\_\+\+M\+A\+S\+T\+E\+R\+\_\+\+H\+A\+N\+D\+L\+E\+\_\+T} $\ast$i2c)
\item 
void $\ast$ \hyperlink{temperature__sensor__task_8c_abc96664d611b8a19036cf6fcaaf92ac8}{temperature\+\_\+task\+\_\+callback} (void $\ast$threadparam)
\begin{DoxyCompactList}\small\item\em Entry point of the temp task thread. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
pthread\+\_\+mutex\+\_\+t {\bfseries temp\+Change\+Lock}\hypertarget{temperature__sensor__task_8c_aef8b0b007a8236bcfd1fd7fbad0e4b13}{}\label{temperature__sensor__task_8c_aef8b0b007a8236bcfd1fd7fbad0e4b13}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyAuthor}{Author}
Gunj Manseta 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
2018-\/03-\/11 
\end{DoxyDate}


\subsection{Function Documentation}
\index{temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}!get\+Handle\+\_\+\+Temperature\+Task\+Queue@{get\+Handle\+\_\+\+Temperature\+Task\+Queue}}
\index{get\+Handle\+\_\+\+Temperature\+Task\+Queue@{get\+Handle\+\_\+\+Temperature\+Task\+Queue}!temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}}
\subsubsection[{\texorpdfstring{get\+Handle\+\_\+\+Temperature\+Task\+Queue()}{getHandle_TemperatureTaskQueue()}}]{\setlength{\rightskip}{0pt plus 5cm}mqd\+\_\+t get\+Handle\+\_\+\+Temperature\+Task\+Queue (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{temperature__sensor__task_8c_afebaba221409b026d6f4648ac50b0c4e}{}\label{temperature__sensor__task_8c_afebaba221409b026d6f4648ac50b0c4e}


Get the Handle Temperature\+Task\+Queue object. 

\begin{DoxyReturn}{Returns}
mqd\+\_\+t 
\end{DoxyReturn}

\begin{DoxyCode}
73 \{
74     \textcolor{keywordflow}{return} temperaturetask\_q;
75 \}
\end{DoxyCode}
\index{temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}!get\+Temp\+Task\+\_\+temperature@{get\+Temp\+Task\+\_\+temperature}}
\index{get\+Temp\+Task\+\_\+temperature@{get\+Temp\+Task\+\_\+temperature}!temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}}
\subsubsection[{\texorpdfstring{get\+Temp\+Task\+\_\+temperature()}{getTempTask_temperature()}}]{\setlength{\rightskip}{0pt plus 5cm}float get\+Temp\+Task\+\_\+temperature (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{temperature__sensor__task_8c_a4bea76689b1b882f95e488a1bb41f5f8}{}\label{temperature__sensor__task_8c_a4bea76689b1b882f95e488a1bb41f5f8}


Get the Temp\+Task temperature object M\+T-\/safe. 

\begin{DoxyReturn}{Returns}
float 
\end{DoxyReturn}

\begin{DoxyCode}
35 \{
36     \textcolor{keywordtype}{float} temp;
37     pthread\_mutex\_lock(&tempChangeLock);
38     temp = latest\_temperature;
39     pthread\_mutex\_unlock(&tempChangeLock);
40     \textcolor{keywordflow}{return} temp;
41 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{temperature__sensor__task_8c_a4bea76689b1b882f95e488a1bb41f5f8_icgraph}
\end{center}
\end{figure}


\index{temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}!temperature\+\_\+task\+\_\+callback@{temperature\+\_\+task\+\_\+callback}}
\index{temperature\+\_\+task\+\_\+callback@{temperature\+\_\+task\+\_\+callback}!temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}}
\subsubsection[{\texorpdfstring{temperature\+\_\+task\+\_\+callback(void $\ast$threadparam)}{temperature_task_callback(void *threadparam)}}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ temperature\+\_\+task\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{threadparam}
\end{DoxyParamCaption}
)}\hypertarget{temperature__sensor__task_8c_abc96664d611b8a19036cf6fcaaf92ac8}{}\label{temperature__sensor__task_8c_abc96664d611b8a19036cf6fcaaf92ac8}


Entry point of the temp task thread. 


\begin{DoxyParams}{Parameters}
{\em threadparam} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void$\ast$ 
\end{DoxyReturn}

\begin{DoxyCode}
185 \{
186     LOG\_STDOUT(INFO \textcolor{stringliteral}{"TEMPERATURE TASK STARTED\(\backslash\)n"});
187 
188     \textcolor{keywordtype}{int} ret = \hyperlink{temperature__sensor__task_8c_ad54a52f7c1962f12523c89f17484f5d9}{temperature\_task\_queue\_init}();
189     \textcolor{keywordflow}{if}(ERR == ret)
190     \{
191         LOG\_STDOUT(ERROR \textcolor{stringliteral}{"TEMPERATURE TASK INIT%s\(\backslash\)n"},strerror(errno));
192         exit(ERR);
193     \}
194 
195     \hyperlink{structi2c__handle}{I2C\_MASTER\_HANDLE\_T} i2c;
196     ret = \hyperlink{temperature__sensor__task_8c_ad16d2f35c6d97e33cfe57e3ab2497064}{temperature\_task\_I2Cinit}(&i2c);
197     \textcolor{keywordflow}{if}(ret)
198     \{
199         LOG\_STDOUT(ERROR \textcolor{stringliteral}{"[FAIL] TEMPERATURE TASK SENSOR INIT:%s\(\backslash\)n"},strerror(errno));
200         \textcolor{keywordflow}{goto} FAIL\_EXIT\_SENSOR;
201         \textcolor{comment}{//exit(ERR);}
202     \}
203 
204     \textcolor{keywordflow}{if}(ret == 0) \{LOG\_STDOUT(INFO \textcolor{stringliteral}{"[OK] Sensor Test\(\backslash\)n"});\}
205     \textcolor{keywordflow}{else} \{LOG\_STDOUT(INFO \textcolor{stringliteral}{"[FAIL] Sensor Test\(\backslash\)n"});\}
206 
207 
208     LOG\_STDOUT(INFO \textcolor{stringliteral}{"TEMPERATURE TASK INIT COMPLETED\(\backslash\)n"});
209     pthread\_barrier\_wait(&tasks\_barrier);
210 
211     \textcolor{comment}{/* Registering a timer for 2 sec to update the task temp copy by getting the temperature value from the
       sensor*/}
212     timer\_t timer\_id;
213     \textcolor{keywordflow}{if}(ERR == \hyperlink{common__helper_8c_a23124253b968391b9777fc3b8a0cc5ec}{register\_and\_start\_timer}(&timer\_id, 2*MICROSEC, 0, 
      timer\_handler\_getAndUpdateTemperature, &timer\_id))
214     \{
215         \textcolor{comment}{// LOG\_STDOUT(ERROR "Timer Error\(\backslash\)n");}
216         \textcolor{keywordflow}{goto} FAIL\_EXIT;
217     \}
218 
219     \textcolor{comment}{/* Process Log queue msg which executes untill the log\_task\_end flag is set to true*/}
220     temperature\_task\_processMsg();
221 
222 
223     ret = \hyperlink{posixTimer_8c_a91f15230e46caba2a2132b04e9c73e47}{delete\_timer}(timer\_id);
224     \textcolor{keywordflow}{if}(ERR == ret)
225     \{
226         LOG\_STDOUT(ERROR \textcolor{stringliteral}{"TEMPERATURE TASK DELETE TIMER:%s\(\backslash\)n"},strerror(errno));
227         exit(1);
228     \}
229 
230 FAIL\_EXIT:
232     \hyperlink{temperature__sensor__task_8c_a7b3917c753224bc64f378ca8e61cc941}{temperature\_task\_I2Cdeinit}(&i2c);
233 
234 FAIL\_EXIT\_SENSOR:
235     mq\_close(temperaturetask\_q);
236     LOG\_STDOUT(INFO \textcolor{stringliteral}{"Temperature task exit.\(\backslash\)n"});
237     \textcolor{keywordflow}{return} SUCCESS;
238 \}\end{DoxyCode}
\index{temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}!temperature\+\_\+task\+\_\+\+I2\+Cdeinit@{temperature\+\_\+task\+\_\+\+I2\+Cdeinit}}
\index{temperature\+\_\+task\+\_\+\+I2\+Cdeinit@{temperature\+\_\+task\+\_\+\+I2\+Cdeinit}!temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}}
\subsubsection[{\texorpdfstring{temperature\+\_\+task\+\_\+\+I2\+Cdeinit(\+I2\+C\+\_\+\+M\+A\+S\+T\+E\+R\+\_\+\+H\+A\+N\+D\+L\+E\+\_\+\+T $\ast$i2c)}{temperature_task_I2Cdeinit(I2C_MASTER_HANDLE_T *i2c)}}]{\setlength{\rightskip}{0pt plus 5cm}int temperature\+\_\+task\+\_\+\+I2\+Cdeinit (
\begin{DoxyParamCaption}
\item[{{\bf I2\+C\+\_\+\+M\+A\+S\+T\+E\+R\+\_\+\+H\+A\+N\+D\+L\+E\+\_\+T} $\ast$}]{i2c}
\end{DoxyParamCaption}
)}\hypertarget{temperature__sensor__task_8c_a7b3917c753224bc64f378ca8e61cc941}{}\label{temperature__sensor__task_8c_a7b3917c753224bc64f378ca8e61cc941}

\begin{DoxyParams}{Parameters}
{\em i2c} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int 
\end{DoxyReturn}

\begin{DoxyCode}
172 \{
173     \textcolor{keywordtype}{int} ret = 0;
174     ret = \hyperlink{my__i2c_8c_a15136dcc397f046d0a000a781d060139}{I2Cmaster\_Destroy}(i2c);
175     \textcolor{keywordflow}{if}(ret !=0)
176     \{
177         \hyperlink{my__i2c_8c_a24206855ca77b181de1cfbe8e9e5051a}{printErrorCode}(ret);
178         LOG\_STDOUT(WARNING \textcolor{stringliteral}{"I2C Master destroy failed\(\backslash\)n"}); 
179     \}
180 
181     \textcolor{keywordflow}{return} ret;
182 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{temperature__sensor__task_8c_a7b3917c753224bc64f378ca8e61cc941_icgraph}
\end{center}
\end{figure}


\index{temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}!temperature\+\_\+task\+\_\+\+I2\+Cinit@{temperature\+\_\+task\+\_\+\+I2\+Cinit}}
\index{temperature\+\_\+task\+\_\+\+I2\+Cinit@{temperature\+\_\+task\+\_\+\+I2\+Cinit}!temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}}
\subsubsection[{\texorpdfstring{temperature\+\_\+task\+\_\+\+I2\+Cinit(\+I2\+C\+\_\+\+M\+A\+S\+T\+E\+R\+\_\+\+H\+A\+N\+D\+L\+E\+\_\+\+T $\ast$i2c)}{temperature_task_I2Cinit(I2C_MASTER_HANDLE_T *i2c)}}]{\setlength{\rightskip}{0pt plus 5cm}int temperature\+\_\+task\+\_\+\+I2\+Cinit (
\begin{DoxyParamCaption}
\item[{{\bf I2\+C\+\_\+\+M\+A\+S\+T\+E\+R\+\_\+\+H\+A\+N\+D\+L\+E\+\_\+T} $\ast$}]{i2c}
\end{DoxyParamCaption}
)}\hypertarget{temperature__sensor__task_8c_ad16d2f35c6d97e33cfe57e3ab2497064}{}\label{temperature__sensor__task_8c_ad16d2f35c6d97e33cfe57e3ab2497064}

\begin{DoxyParams}{Parameters}
{\em i2c} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int 
\end{DoxyReturn}

\begin{DoxyCode}
154 \{
155     \textcolor{keywordtype}{int} ret = 0;
156     \textcolor{keywordflow}{if}(ret = \hyperlink{my__i2c_8c_acea2b6a0875bf63a179959a46b3cdf7d}{I2Cmaster\_Init}(i2c) !=0)
157     \{
158         \hyperlink{my__i2c_8c_a24206855ca77b181de1cfbe8e9e5051a}{printErrorCode}(ret);
159         LOG\_STDOUT(ERROR \textcolor{stringliteral}{"[FAIL] I2C Master init failed\(\backslash\)n"}); 
160     \}
161 
162     \textcolor{keywordflow}{return} ret;
163 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{temperature__sensor__task_8c_ad16d2f35c6d97e33cfe57e3ab2497064_icgraph}
\end{center}
\end{figure}


\index{temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}!temperature\+\_\+task\+\_\+queue\+\_\+init@{temperature\+\_\+task\+\_\+queue\+\_\+init}}
\index{temperature\+\_\+task\+\_\+queue\+\_\+init@{temperature\+\_\+task\+\_\+queue\+\_\+init}!temperature\+\_\+sensor\+\_\+task.\+c@{temperature\+\_\+sensor\+\_\+task.\+c}}
\subsubsection[{\texorpdfstring{temperature\+\_\+task\+\_\+queue\+\_\+init()}{temperature_task_queue_init()}}]{\setlength{\rightskip}{0pt plus 5cm}int temperature\+\_\+task\+\_\+queue\+\_\+init (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{temperature__sensor__task_8c_ad54a52f7c1962f12523c89f17484f5d9}{}\label{temperature__sensor__task_8c_ad54a52f7c1962f12523c89f17484f5d9}
\begin{DoxyReturn}{Returns}
int 
\end{DoxyReturn}

\begin{DoxyCode}
83 \{
84     \textcolor{keyword}{struct }mq\_attr temperaturetaskQ\_attr = \{
85         .mq\_msgsize = \textcolor{keyword}{sizeof}(\hyperlink{structTEMPERATURETASKQ__MSG__T}{TEMPERATURETASKQ\_MSG\_T}),
86         .mq\_maxmsg = 128,
87         .mq\_flags = 0,
88         .mq\_curmsgs = 0
89     \};
90 
91     mq\_unlink(MQ\_TEMPERATURETASK\_NAME);
92     temperaturetask\_q = mq\_open(MQ\_TEMPERATURETASK\_NAME, O\_CREAT | O\_RDWR, 0666, &temperaturetaskQ\_attr);
93 
94     \textcolor{keywordflow}{return} temperaturetask\_q;;
95 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{temperature__sensor__task_8c_ad54a52f7c1962f12523c89f17484f5d9_icgraph}
\end{center}
\end{figure}


